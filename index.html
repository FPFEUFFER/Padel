<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inscriptions Padel</title>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      max-width: 600px;
      margin: auto;
      background: #f9f9f9;
    }
    h1 { text-align: center; }
    .session {
      background: #fff;
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .session h3 {
      margin-top: 0;
    }
    .players {
      margin-top: 0.5rem;
    }
    input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.5rem 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Inscriptions Padel</h1>
  <input type="text" id="playerName" placeholder="Votre prénom" />
  <div id="schedule"></div>
  <button onclick="submitInscriptions()">S'inscrire</button>

  <script>
    const sessions = {
      "Lundi": ["18h30", "20h00", "21h30"],
      "Mardi": ["18h30", "20h00", "21h30"],
      "Mercredi": ["18h30", "20h00", "21h30"],
      "Jeudi": ["18h30", "20h00", "21h30"],
      "Vendredi": ["14h00", "15h30", "17h00", "18h30", "20h00", "21h30"],
      "Dimanche": ["09h00", "10h30", "12h00", "18h00", "19h30", "21h00"]
    };

    const inscriptions = {};

    function createSchedule() {
      const container = document.getElementById("schedule");
      for (const [day, times] of Object.entries(sessions)) {
        times.forEach(time => {
          const key = `${day} ${time}`;
          inscriptions[key] = [];
          const div = document.createElement("div");
          div.className = "session";
          div.innerHTML = `
            <h3>${key}</h3>
            <label><input type="checkbox" id="${key}" /> S'inscrire</label>
            <div class="players" id="players-${key.replace(/\s/g, '-')}">Aucun inscrit</div>
          `;
          container.appendChild(div);
        });
      }
    }

    function submitInscriptions() {
      const name = document.getElementById("playerName").value.trim();
      if (!name) {
        alert("Merci d'indiquer votre prénom.");
        return;
      }
      let alertSessions = [];
      for (const [day, times] of Object.entries(sessions)) {
        times.forEach(time => {
          const key = `${day} ${time}`;
          const checkbox = document.getElementById(key);
          if (checkbox.checked && !inscriptions[key].includes(name)) {
            inscriptions[key].push(name);
            updatePlayersList(key);
            if (inscriptions[key].length === 5) {
              alertSessions.push(key);
            }
          }
        });
      }
      if (alertSessions.length > 0) {
        sendEmailNotification(alertSessions);
      }
      alert("Inscription enregistrée !");
    }

    function updatePlayersList(key) {
      const el = document.getElementById("players-" + key.replace(/\s/g, '-'));
      const players = inscriptions[key];
      el.innerHTML = players.length === 0 ? "Aucun inscrit" : players.join(", ");
      if (players.length > 4) {
        el.innerHTML += ` <strong>(+${players.length - 4} en liste d'attente)</strong>`;
      }
    }

    function sendEmailNotification(keys) {
      emailjs.init("DnZcVIriziObzEXZE");
      emailjs.send("service_7ls3up6", "template_xx7wwgg", {
        message: `Plus de 4 inscrits pour les créneaux suivants :\n${keys.join('\n')}`,
        to_email: "pfeuffer.florian@gmail.com"
      })
      .then(() => console.log("Email envoyé"))
      .catch(err => console.error("Erreur email:", err));
    }

    createSchedule();
  </script>
</body>
</html>
